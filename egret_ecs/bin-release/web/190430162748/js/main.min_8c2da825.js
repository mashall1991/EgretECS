var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function a(e){try{c(o.next(e))}catch(t){s(t)}}function i(e){try{c(o["throw"](e))}catch(t){s(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,i)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(a=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(s,n[1])).done)return a;switch(s=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(o){n=[6,o],s=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,a,i,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},Component=function(){function e(){this._instanceId=IdGenerator.GenerateInstanceId()}return Object.defineProperty(e.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),e}();__reflect(Component.prototype,"Component",["IComponent"]);var Entity=function(){function e(){this._instanceId=IdGenerator.GenerateInstanceId(),this.components={}}return Object.defineProperty(e.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),e.prototype.Entity=function(){},e.prototype.addComponent=function(e){var t=new e,n=ClassUtil.getInstanceClassName(t),o=this.components[n];return null==o&&(this.components[n]=t),this.components[n]},e.prototype.addComponent_=function(e){var t=ClassUtil.getInstanceClassName(e),n=this.components[t];return null==n?(this.components[t]=e,e):n},e.prototype.removeComponent=function(e){var t=ClassUtil.getInstanceClassName(e);this.components[t]?delete this.components[t]:console.warn("Entity:"+ClassUtil.getInstanceClassName(this)+" does not contain "+t+" .")},e.prototype.getComponent_=function(e){var t=ClassUtil.getInstanceClassName(e),n=this.components[t];return null==n&&console.warn("Entity:"+ClassUtil.getInstanceClassName(this)+" does not contain "+t+" ."),n},e.prototype.getComponentByName=function(e){var t=this.components[e];return null==t&&console.warn("Entity:"+ClassUtil.getInstanceClassName(this)+" does not contain "+e+" ."),t},e.prototype.getComponent=function(e){var t=ClassUtil.getClassName(e),n=this.components[t];return null==n&&console.warn("Entity:"+ClassUtil.getInstanceClassName(this)+" does not contain "+t+" ."),n},e.prototype.getComponents=function(){var e=[];for(var t in this.components){var n=this.components[t];e.push(n)}return e},e}();__reflect(Entity.prototype,"Entity",["IComponent"]);var UIComponent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._instanceId=IdGenerator.GenerateInstanceId(),t}return __extends(t,e),Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(UIComponent.prototype,"UIComponent",["IComponent"]);var UISystem=function(){function e(){this.instanceId=IdGenerator.GenerateInstanceId()}return e.prototype.addToStage=function(){var e=World.shareInstance.createSystem(UIManageSystem),t=e.FindUIComponentWithSysId(this.instanceId);null!=t&&e.isTop(t)&&this.onActive(),this.onShow()},e.prototype.removeToStage=function(){this.onHide()},e}();__reflect(UISystem.prototype,"UISystem",["ISystem","IAddToStageSystem","IRemoveToStageSystem","IShowSystem","IHideSystem"]);var UILayerType;!function(e){e[e.UITop=1]="UITop",e[e.UITips=2]="UITips",e[e.UIMid=3]="UIMid",e[e.UIBottom=4]="UIBottom"}(UILayerType||(UILayerType={}));var UIEntity=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.compAndSysMap={},t.uiStack=new Array,t}return __extends(t,e),t}(Entity);__reflect(UIEntity.prototype,"UIEntity");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,n,o,r,s,a,i,c,u,p,l;return __generator(this,function(y){switch(y.label){case 0:return[4,this.loadResource()];case 1:return y.sent(),[4,RES.getResAsync("description_json")];case 2:return e=y.sent(),[4,platform.login()];case 3:return y.sent(),[4,platform.getUserInfo()];case 4:return n=y.sent(),console.log(n),t.STAGE=this.stage,t.mainEntrace=this,this.stage.frameRate=60,o=World.shareInstance.createEntity(AnEntity),r=o.addComponent_(new TimeComponent),s=o.addComponent(VectorComponent),r.deltaTime=10,s.x=10,s.y=20,a=World.shareInstance.entityFilter([VectorComponent,TimeComponent]),i=World.shareInstance.createSystem(EventSystem),i.execute(),c=World.shareInstance.createSystem(GameSystem),c.execute(),u=World.shareInstance.createSystem(UIManageSystem),u.execute(),u.regist(TestUI,TestUISystem),p=u.openUI(TestUI),l=World.shareInstance.createSystem(UILoadSystem),l.execute(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t}(eui.UILayer);__reflect(Main.prototype,"Main");var IdGenerator=function(){function e(){}return Object.defineProperty(e,"AppId",{get:function(){return this.appId},set:function(e){this.appId=e,this.instanceIdGenerator=this.appId<<48},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GenerateId",{get:function(){var e=egret.getTimer();return(this.appId<<48)+(e<<16)+ ++this.value},enumerable:!0,configurable:!0}),e.GenerateInstanceId=function(){return++this.instanceIdGenerator},e.instanceIdGenerator=0,e}();__reflect(IdGenerator.prototype,"IdGenerator");var World=function(){function e(){this.entities={},this.systems={},this.updateSystems=[]}return Object.defineProperty(e,"shareInstance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.entityFilter=function(e){for(var t=[],n=[],o=0;o<e.length;o++){var r=e[o],s=ClassUtil.getClassName(r);t.push(s)}for(var a in this.entities){for(var i=!0,c=this.entities[a],o=0;o<t.length;o++){var u=t[o],r=c.getComponentByName(u);i=!(null==r)}i&&n.push(c)}return n},e.prototype.getEntity=function(e){return this.entities[ClassUtil.getClassName(e)]},e.prototype.createEntity=function(e){var t=new e;return this.entities[ClassUtil.getInstanceClassName(t)]=t,t},e.prototype.createSystem=function(e){var t=ClassUtil.getClassName(e),n=this.systems[t];if(null==n){n=new e,this.systems[t]=n;var o=e.prototype.__types__;for(var r in o){var s=o[r];"IUpdateSystem"==s&&this.updateSystems.push(n)}}return n},e.prototype.getSystem=function(e){return this.systems[ClassUtil.getClassName(e)]},e._instance=new e,e}();__reflect(World.prototype,"World");var EventDispatcherComponent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._instanceId=IdGenerator.GenerateInstanceId(),t}return __extends(t,e),Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),t}(egret.EventDispatcher);__reflect(EventDispatcherComponent.prototype,"EventDispatcherComponent",["IComponent"]);var EventEntity=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Entity);__reflect(EventEntity.prototype,"EventEntity");var EventMetaComponent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._instanceId=IdGenerator.GenerateInstanceId(),t}return __extends(t,e),Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!0,configurable:!0}),t}(egret.Event);__reflect(EventMetaComponent.prototype,"EventMetaComponent",["IComponent"]);var EventSystem=function(){function e(){}return e.prototype.execute=function(){var e=World.shareInstance.createEntity(EventEntity);e.addComponent(EventDispatcherComponent)},e.prototype.getEventEntity=function(){return World.shareInstance.getEntity(EventEntity)},e.prototype.addEventListener=function(e,t,n,o,r){var s=this.getEventEntity(),a=s.getComponent(EventDispatcherComponent);a.addEventListener(e,t,n,o,r)},e.prototype.removeEventListener=function(e,t,n,o){var r=this.getEventEntity(),s=r.getComponent(EventDispatcherComponent);s.removeEventListener(e,t,n,o)},e.prototype.dispatchEvent=function(e,t){void 0===t&&(t=null);var n=egret.Event.create(EventMetaComponent,e,!1,!1);n.data=t;var o=this.getEventEntity(),r=o.getComponent(EventDispatcherComponent);r.dispatchEvent(n),egret.Event.release(n)},e}();__reflect(EventSystem.prototype,"EventSystem",["ISystem"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var UIManageSystem=function(){function e(){}return e.prototype.execute=function(){var e=World.shareInstance.createEntity(UIEntity),t=World.shareInstance.getEntity(GameEntity),n=t.getComponent(GameComponent).main;e.layerBottom=new eui.UILayer,n.addChild(e.layerBottom),e.layerMiddle=new eui.UILayer,n.addChild(e.layerMiddle),e.layerTips=new eui.UILayer,e.layerTips.touchEnabled=!1,n.addChild(e.layerTips),e.layerTop=new eui.UILayer,e.layerTop.touchEnabled=!1,n.addChild(e.layerTop)},e.prototype.regist=function(e,t){var n=World.shareInstance.getEntity(UIEntity),o=ClassUtil.getClassName(e);if(n.compAndSysMap[o])return console.warn(o+" [UIComponent] has already registed."),n.compAndSysMap[o];var r=new e,s=World.shareInstance.createSystem(t),a={ui:r,system:s};return n.compAndSysMap[o]=a,a},e.prototype.openUI=function(e,t){var n=World.shareInstance.getEntity(UIEntity),o=ClassUtil.getClassName(e),r=n.compAndSysMap[o];if(null==r)return console.error("UI:"+o+" does not regist."),null;var s=r.ui;this.didUIOpen(e)&&console.error("UI:"+o+" has opened do not open it again.");var a=r.system,i=n.layerMiddle;if(null!=t)switch(t){case UILayerType.UIBottom:i=n.layerBottom;break;case UILayerType.UIMid:i=n.layerMiddle;break;case UILayerType.UITips:i=n.layerTips;break;case UILayerType.UITop:i=n.layerTop}s.addEventListener(egret.Event.ADDED_TO_STAGE,a.addToStage,a),s.addEventListener(egret.Event.REMOVED_FROM_STAGE,a.removeToStage,a),i.addChild(s),n.uiStack.push(s)},e.prototype.closeUI=function(t,n){var o=World.shareInstance.getEntity(UIEntity),r=o.uiStack.pop();ClassUtil.getInstanceClassName(r)==ClassUtil.getClassName(t)?e.removeDisplay(r):(console.error("You should close ui which is on the top first."),o.uiStack.push(r))},e.prototype.closeUI_=function(t){var n=World.shareInstance.getEntity(UIEntity),o=n.uiStack.pop();ClassUtil.getInstanceClassName(o)==ClassUtil.getInstanceClassName(t)?e.removeDisplay(o):(console.error("You should close ui which is on the top first."),n.uiStack.push(o))},e.prototype.didUIOpen=function(e){var t=!1,n=World.shareInstance.getEntity(UIEntity);for(var o in n.uiStack){var r=n.uiStack[o];ClassUtil.getInstanceClassName(r)==ClassUtil.getClassName(e)&&(t=!0)}return t},e.prototype.didUIOnActive=function(e){return!1},e.prototype.isTop=function(e){var t=World.shareInstance.getEntity(UIEntity);if(t.uiStack.length>=1){var n=t.uiStack.length-1,o=t.uiStack[n];return ClassUtil.getInstanceClassName(o)==ClassUtil.getInstanceClassName(e)}return!0},e.prototype.FindUIComponentWithSysId=function(e){var t=World.shareInstance.getEntity(UIEntity);for(var n in t.compAndSysMap){var o=t.compAndSysMap[n],r=o.system;if(r.instanceId==e)return o.ui}return null},e.removeDisplay=function(e,t){void 0===t&&(t=null),e&&(t||(t=e.parent),t&&t.removeChild(e))},e}();__reflect(UIManageSystem.prototype,"UIManageSystem",["ISystem"]);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function r(e){t.call(o,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(o))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var i=e.split("/");i.pop();var c=i.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(o,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var UILoadSystem=function(){function e(){}return e.prototype.execute=function(){console.log("UIloadSystem executed.")},e.prototype.update=function(e){},e}();__reflect(UILoadSystem.prototype,"UILoadSystem",["ISystem","IUpdateSystem"]);var ClassUtil=function(){function e(){}return e.getInstanceClassName=function(e){return e.__proto__.__class__},e.getClassName=function(e){return e.prototype.__class__},e}();__reflect(ClassUtil.prototype,"ClassUtil");var AnEntity=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.NAME="AnEntity",t}(Entity);__reflect(AnEntity.prototype,"AnEntity");var FilterSystem=function(){function e(){}return e.prototype.execute=function(){console.log("FilterSystem , execute()")},e}();__reflect(FilterSystem.prototype,"FilterSystem",["ISystem"]);var GameComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Component);__reflect(GameComponent.prototype,"GameComponent");var GameEntity=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Entity);__reflect(GameEntity.prototype,"GameEntity");var GameSystem=function(){function e(){}return e.prototype.execute=function(){var e=World.shareInstance.createEntity(GameEntity),t=e.addComponent(GameComponent);t.stage=Main.STAGE,t.main=Main.mainEntrace,t.gameInitTime=egret.getTimer(),t.frameListenner=new egret.Sprite,t.lastFrameEventTime=t.gameInitTime;World.shareInstance.getSystem(EventSystem);t.frameListenner.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},e.prototype.update=function(){var e=World.shareInstance,t=e.getEntity(GameEntity),n=t.getComponent(GameComponent),o=egret.getTimer(),r=(o-n.lastFrameEventTime)/1e3;n.lastFrameEventTime=o,n.deltaTime=r;for(var s=0;s<e.updateSystems.length;s++){var a=e.updateSystems[s];a.update(r)}},e}();__reflect(GameSystem.prototype,"GameSystem",["ISystem"]);var TimeComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Component);__reflect(TimeComponent.prototype,"TimeComponent");var VectorComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Component);__reflect(VectorComponent.prototype,"VectorComponent");var TestUI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skinName="resource/eui_skins/test/uiTestSkin.exml",t}return __extends(t,e),t}(UIComponent);__reflect(TestUI.prototype,"TestUI");var TestUI1=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skinName="resource/eui_skins/test/uiTestSkin1.exml",t}return __extends(t,e),t}(UIComponent);__reflect(TestUI1.prototype,"TestUI1");var TestUISystem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(){console.log("TestUISystem,execute")},t.prototype.onActive=function(){console.log("TestUISystem,onActive")},t.prototype.onUILoaded=function(){console.log("TestUISystem,onUILoaded")},t.prototype.onShow=function(){console.log("TestUISystem,onShow");var e=World.shareInstance.getSystem(UIManageSystem),t=e.FindUIComponentWithSysId(this.instanceId);t.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseTouch,this),t.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOpenTouch,this)},t.prototype.onHide=function(){console.log("TestUISystem,onHide")},t.prototype.onCloseTouch=function(){console.log("close TestUI")},t.prototype.onOpenTouch=function(){var e=World.shareInstance.getSystem(UIManageSystem);e.regist(TestUI1,TestUISystem1),e.openUI(TestUI1)},t}(UISystem);__reflect(TestUISystem.prototype,"TestUISystem");var TestUISystem1=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(){console.log("TestUISystem1,execute")},t.prototype.onActive=function(){console.log("TestUISystem1,onActive")},t.prototype.onUILoaded=function(){console.log("TestUISystem1,onUILoaded")},t.prototype.onShow=function(){console.log("TestUISystem1,onShow");var e=World.shareInstance.getSystem(UIManageSystem),t=e.FindUIComponentWithSysId(this.instanceId);t.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseTouch,this)},t.prototype.onHide=function(){console.log("TestUISystem1,onHide")},t.prototype.onCloseTouch=function(){console.log("close TestUI1");var e=World.shareInstance.getSystem(UIManageSystem);e.closeUI(TestUI1)},t}(UISystem);__reflect(TestUISystem1.prototype,"TestUISystem1");